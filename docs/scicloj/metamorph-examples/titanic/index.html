<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script src="https://cdn.statically.io/gh/scicloj/gorilla-notes@master/dist/0.5.5/main.js"></script>
    <script>
     shadow.loader.load("main");
     gorilla_notes.main.main_BANG_(false, "{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :initially-collapse? false, :auto-scroll? false, :port 1903, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Sat Mar 06 01:27:52 CET 2021\"] nil [:hr]], :custom-footer [:div [:hr] [:hr]]}, :ids [\"171\" \"172\" \"173\" \"174\" \"175\" \"176\" \"177\" \"178\" \"179\" \"180\" \"181\" \"182\" \"183\" \"184\" \"185\" \"186\" \"187\" \"188\" \"189\" \"190\" \"191\" \"192\" \"193\" \"194\" \"195\" \"196\" \"197\" \"198\" \"199\" \"200\" \"201\" \"202\" \"203\" \"204\" \"205\" \"206\" \"207\" \"208\" \"209\" \"210\" \"211\" \"212\" \"213\" \"214\" \"215\" \"216\" \"217\" \"218\" \"219\" \"220\" \"221\" \"222\" \"223\" \"224\" \"225\"], :id->content {\"191\" [:div nil nil [:p/markdown \"Often we consider the model with the lowest loss to be the best.\"]], \"180\" [:div nil nil [:p/markdown \"Create a sequence of train/test used to evaluate the pipeline.\"]], \"219\" [:div nil nil [:p/markdown \"Get the key information from the evaluations and sort by the metric function used, accuracy here.\"]], \"188\" [:div [:p/code {:code \"(def evaluations\\n  (eval-mm/evaluate-pipelines\\n   [pipeline-fn]\\n   splits\\n   loss/classification-accuracy\\n   :accuracy))\", :bg-class \"bg-light\"}] nil nil], \"201\" [:div [:p/code {:code \"(:metric (first models))\", :bg-class \"bg-light\"}] nil [:p/code {:code \"0.8260869565217391\\n\"}]], \"185\" [:div nil nil [:p/markdown \"The pipeline definition\"]], \"175\" [:div nil nil [:p/markdown \"Column names:\"]], \"202\" [:div nil nil [:p/markdown \"The pre-processed data is:\"]], \"195\" [:div [:p/code {:code \"(def models\\n  (->> evaluations\\n       (map\\n        #(hash-map :model (tech.v3.ml/thaw-model (get-in % [:fitted-ctx :model]))\\n                   :metric (:metric %)\\n                   :fitted-ctx (:fitted-ctx %)\\n                   :data (get-in % [:fitted-ctx :metamorph/data])))\\n       (sort-by :metric)\\n       reverse\\n       ))\", :bg-class \"bg-light\"}] nil nil], \"193\" [:div nil nil [:p/markdown \"`tech.ml` stores the models ion the context in a serialzed form,\\nand the function `thaw-model` can be used to get the original model back.\\nThis is a Java class in the case of\\n model :smile.classification/random.forest, but this depends on the\\nwhich `model` function is in the pipeline\"]], \"224\" [:div nil nil [:p/markdown \"with a accuracy of :\"]], \"196\" [:div nil nil [:p/markdown \"The 1 (best out of 5) trained model is:\"]], \"207\" [:div nil nil [:p/markdown \"Out of the predictions and the trueth, we can construct the\\n confusion matrix.\"]], \"179\" [:div [:p/code {:code \"(def new-data (:train (first splits-1)))\", :bg-class \"bg-light\"}] nil nil], \"221\" [:div [:p/code {:code \"(def best-model (first models))\", :bg-class \"bg-light\"}] nil nil], \"192\" [:div nil nil [:p/markdown \"The evaluation results contains all data sets for test and prediction\\n, all models, and the loss\\nfor each cross validation\"]], \"213\" [:div nil nil [:p/markdown \"Use sobol optimization, to find 100 grid points,\\nwich cover in a smart way the full hyper-parameter space.\"]], \"197\" [:div [:p/code {:code \"(map #(dissoc % :data :fitted-ctx) models)\", :bg-class \"bg-light\"}] nil [:p/code {:code \"({:metric 0.8260869565217391,\\n  :model\\n  #object[smile.classification.RandomForest 0x163ee5cd \\\"smile.classification.RandomForest@163ee5cd\\\"]})\\n\"}]], \"225\" [:div [:p/code {:code \"(:metric best-model)\", :bg-class \"bg-light\"}] nil [:p/code {:code \"0.8571428571428571\\n\"}]], \"203\" [:div [:p/code {:code \"^kind/dataset-grid\\n(:data (first models))\", :bg-class \"bg-light\"}] nil [:div {:class \"ag-theme-balham\", :style {:height \"150px\"}} [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(showing at most 100 rows)\"]] [:p/dataset {:columnDefs [{:headerName \"survived\", :field \"survived\"} {:headerName \"pclass\", :field \"pclass\"} {:headerName \"sex\", :field \"sex\"} {:headerName \"age\", :field \"age\"} {:headerName \"title\", :field \"title\"}], :rowData ({\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" nil, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 32.5, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 52.0, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 49.0, \"title\" 7.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 0.67, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 43.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" nil, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" nil, \"title\" 6.0} {\"survived\" 0.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 30.0, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" nil, \"title\" 7.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 1.0, \"age\" 24.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 60.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 1.0, \"age\" 24.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 19.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 23.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 24.0, \"title\" 7.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 39.0, \"title\" 6.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 21.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 32.0, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" nil, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 2.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 33.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 38.0, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 22.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 48.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" nil, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 47.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 42.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 39.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 44.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 26.0, \"title\" 4.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" nil, \"title\" 7.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 24.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 1.0, \"age\" 34.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 19.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 44.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 53.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 1.0, \"age\" 28.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 31.0, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 40.5, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 3.0, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 26.0, \"title\" 7.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 50.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 35.0, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 36.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 39.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 37.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 30.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 0.83, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 26.0, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 45.0, \"title\" 6.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 26.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 30.0, \"title\" 7.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" nil, \"title\" 7.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 24.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 35.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 28.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 22.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 0.42, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" nil, \"title\" 6.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 6.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 28.0, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 47.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 25.0, \"title\" 6.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 20.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" nil, \"title\" 6.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 28.0, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 30.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 21.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 48.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 22.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 1.0, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" nil, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 29.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 1.0, \"age\" 24.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 21.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 51.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" nil, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 28.0, \"title\" 6.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" 31.0, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 29.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 22.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 48.0, \"title\" 3.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 1.0, \"age\" 50.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 0.0, \"sex\" 0.0, \"age\" nil, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 40.0, \"title\" 7.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 1.0, \"age\" 30.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 32.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 21.0, \"title\" 3.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 38.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 2.0, \"sex\" 1.0, \"age\" 32.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 0.75, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 15.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" nil, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 34.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 2.0, \"sex\" 0.0, \"age\" 16.0, \"title\" 5.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" nil, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 1.0, \"sex\" 1.0, \"age\" 30.0, \"title\" 5.0} {\"survived\" 1.0, \"pclass\" 0.0, \"sex\" 1.0, \"age\" 41.0, \"title\" 7.0} {\"survived\" 0.0, \"pclass\" 1.0, \"sex\" 0.0, \"age\" 21.0, \"title\" 5.0})}]]], \"172\" [:div [:p/code {:code \"(require '[scicloj.metamorph.core :as morph]\\n         '[tablecloth.pipeline :as tc-mm]\\n         '[tablecloth.api]\\n         '[tech.v3.ml.metamorph :as ml-mm]\\n         '[tech.v3.dataset.metamorph :as ds-mm]\\n         '[tech.v3.dataset.column-filters :as cf]\\n         '[camel-snake-kebab.core :as csk]\\n         '[clojure.string :as str]\\n         '[scicloj.metamorph.ml :as eval-mm]\\n         '[tech.v3.ml.loss :as loss]\\n         '[tech.v3.ml.gridsearch :as grid]\\n         '[tech.v3.libs.smile.classification]\\n         '[tech.v3.ml.classification :as classif])\", :bg-class \"bg-light\"}] nil nil], \"176\" [:div [:p/code {:code \"(tablecloth.api/column-names data)\", :bg-class \"bg-light\"}] nil [:p/code {:code \"(:passenger-id\\n :survived\\n :pclass\\n :name\\n :sex\\n :age\\n :sib-sp\\n :parch\\n :ticket\\n :fare\\n :cabin\\n :embarked)\\n\"}]], \"212\" [:div [:p/code {:code \"(defn make-pipeline-fn [options]\\n  (morph/pipeline\\n   (if (:use-age? options)\\n     (tc-mm/select-columns [:survived :pclass :name :sex :age])\\n     (tc-mm/select-columns [:survived :pclass :name :sex])\\n     )\\n   (morph/lift name->title)\\n   (ds-mm/categorical->number [:survived :pclass :sex :title])\\n   (ds-mm/set-inference-target :survived)\\n   (fn [ctx]\\n     (assoc ctx\\n            :scicloj.metamorph.ml/target-ds (cf/target (:metamorph/data ctx))))\\n   {:metamorph/id :model}\\n   (ml-mm/model\\n    (merge options\\n           {:model-type :smile.classification/random-forest})\\n    )\\n   ))\", :bg-class \"bg-light\"}] nil nil], \"199\" [:div [:p/code {:code \"(:model (first models))\", :bg-class \"bg-light\"}] nil [:p/code {:code \"#object[smile.classification.RandomForest 0x163ee5cd \\\"smile.classification.RandomForest@163ee5cd\\\"]\\n\"}]], \"210\" [:div nil nil [:p/markdown \"### Hyper parameter tuning\"]], \"186\" [:div [:p/code {:code \"(def pipeline-fn\\n  (morph/pipeline\\n   (tc-mm/select-columns [:survived :pclass :name :sex :age])\\n\\n   ;; included th custom function via lifting in the pipeline\\n   (morph/lift name->title)\\n\\n   (ds-mm/categorical->number [:survived :pclass :sex :title])\\n   (ds-mm/set-inference-target :survived)\\n\\n   ;; this key in the data is required by the function\\n   ;; scicloj.metamorph.ml/evaluate-pipeline\\n   ;; and need to contain the target variable (the trueth)\\n   ;; as a dataset\\n   (fn [ctx]\\n     (assoc ctx\\n            :scicloj.metamorph.ml/target-ds (cf/target (:metamorph/data ctx))))\\n\\n   ;; we overwrite the id, so the model function will store\\n   ;; it's output (the model) in the pipeline ctx under key :model\\n   {:metamorph/id :model}\\n   (ml-mm/model {:model-type :smile.classification/random-forest})\\n   ))\", :bg-class \"bg-light\"}] nil nil], \"181\" [:div [:p/code {:code \"(def splits (tablecloth.api/split->seq\\n             (:test (first splits-1))\\n             :kfold))\", :bg-class \"bg-light\"}] nil nil], \"184\" [:div [:p/code {:code \"(defn name->title [dataset]\\n  (-> dataset\\n      (tablecloth.api/add-or-replace-column\\n       :title\\n       (map\\n        #(-> % (str/split  #\\\"\\\\.\\\")\\n             first\\n             (str/split  #\\\"\\\\,\\\")\\n             last\\n             str/trim)\\n        (data :name)))\\n      (tablecloth.api/drop-columns :name)))\", :bg-class \"bg-light\"}] nil nil], \"173\" [:div nil nil [:p/markdown \"### Read data\"]], \"190\" [:div nil nil [:p/markdown \"The `evaluate-pipelines` fn averages the models per pipe-fn,\\nand returns the best.\\nSo we get a single model back, as we only have one pipe fn\"]], \"222\" [:div nil nil [:p/markdown \"The one with the highest accuracy is then:\"]], \"208\" [:div [:p/code {:code \"(def trueth\\n  (->\\n   (pipeline-fn {:metamorph/data new-data :metamorph/mode :fit })\\n   :metamorph/data\\n   tech.v3.dataset.modelling/labels))\", :bg-class \"bg-light\"}] nil nil], \"218\" [:div [:p/code {:code \"(def evaluations\\n  (eval-mm/evaluate-pipelines\\n   pipeline-fns\\n   splits\\n   loss/classification-accuracy\\n   :accuracy\\n   10\\n   ))\", :bg-class \"bg-light\"}] nil nil], \"194\" [:div nil nil [:p/markdown \"We can get for example,  the models like this:\"]], \"209\" [:div [:p/code {:code \"^kind/dataset\\n(->\\n (classif/confusion-map (:survived predictions)\\n                        (:survived trueth)\\n                        :none)\\n (classif/confusion-map->ds))\", :bg-class \"bg-light\"}] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"230px\"}} [:p/markdown \"_unnamed [3 3]:\\n\\n| :column-name |       0 |       1 |\\n|--------------|---------|---------|\\n|  column-name |       0 |       1 |\\n|            0 |      40 |       8 |\\n|            1 |      16 |      26 |\\n\"]]], \"174\" [:div [:p/code {:code \"(def data (tablecloth.api/dataset \\\"data/titanic/train.csv\\\" {:key-fn csk/->kebab-case-keyword}))\", :bg-class \"bg-light\"}] nil nil], \"171\" [:div [:p/code {:code \"(comment\\n  (note/init-with-browser)\\n  (note/eval-this-notespace)\\n  (note/reread-this-notespace)\\n  (note/init)\\n  )\", :bg-class \"bg-light\"}] nil [:p/code {:code \"nil\\n\"}]], \"200\" [:div nil nil [:p/markdown \"with a accuracy of :\"]], \"183\" [:div nil nil [:p/markdown \"We want to create a new column :title which might help in the score.\\nThis is an example of custom function, which creates a new column from existing columns,\\nwhich is a typical case of feature ingeneering.\"]], \"223\" [:div [:p/code {:code \"(:model best-model)\", :bg-class \"bg-light\"}] nil [:p/code {:code \"#object[smile.classification.RandomForest 0x4288a1b6 \\\"smile.classification.RandomForest@4288a1b6\\\"]\\n\"}]], \"205\" [:div [:p/code {:code \"(def predictions\\n  (->\\n   (pipeline-fn\\n    (assoc\\n     (:fitted-ctx (first models))\\n     :metamorph/data new-data\\n     :metamorph/mode :transform\\n     ))\\n   :metamorph/data))\", :bg-class \"bg-light\"}] nil nil], \"206\" [:div [:p/code {:code \"^kind/dataset\\npredictions\", :bg-class \"bg-light\"}] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \":_unnamed [90 3]:\\n\\n|       0 |       1 | :survived |\\n|---------|---------|-----------|\\n|  0.2785 |  0.7215 |       1.0 |\\n|  0.7153 |  0.2847 |       0.0 |\\n|  0.7432 |  0.2568 |       0.0 |\\n|  0.8058 |  0.1942 |       0.0 |\\n|  0.4590 |  0.5410 |       1.0 |\\n|  0.7714 |  0.2286 |       0.0 |\\n|  0.7775 |  0.2225 |       0.0 |\\n|  0.2477 |  0.7523 |       1.0 |\\n|  0.6447 |  0.3553 |       0.0 |\\n|  0.7778 |  0.2222 |       0.0 |\\n|  0.2396 |  0.7604 |       1.0 |\\n|  0.4548 |  0.5452 |       1.0 |\\n|  0.6492 |  0.3508 |       0.0 |\\n|  0.7666 |  0.2334 |       0.0 |\\n|  0.5689 |  0.4311 |       0.0 |\\n|  0.7920 |  0.2080 |       0.0 |\\n|  0.8132 |  0.1868 |       0.0 |\\n|  0.3024 |  0.6976 |       1.0 |\\n|  0.6865 |  0.3135 |       0.0 |\\n|  0.4107 |  0.5893 |       1.0 |\\n|  0.4590 |  0.5410 |       1.0 |\\n|  0.2647 |  0.7353 |       1.0 |\\n|  0.7361 |  0.2639 |       0.0 |\\n|  0.7481 |  0.2519 |       0.0 |\\n|  0.7427 |  0.2573 |       0.0 |\\n\"]]], \"216\" [:div [:p/code {:code \"(def pipeline-fns (map make-pipeline-fn search-grid))\", :bg-class \"bg-light\"}] nil nil], \"217\" [:div nil nil [:p/markdown \"Evaluate all 100 pipelines\"]], \"177\" [:div nil nil [:p/markdown \"Use part of the data as new-data to predict on later.\"]], \"211\" [:div nil nil [:p/markdown \"This defines a pipeline with options. The options gets passed to the model function,\\nso become hyper-parameters of the model.\\n\\nThe `use-age?` options is used to make a conditional pipeline. As the use-age? variable becomes part of the grid to search in,\\nwe tune it as well.\\nThis is an example how pipeline-options can be grid searched in the same way then hyper-parametes of th model.\\n\\n\"]], \"198\" [:div nil nil [:p/markdown \"The one with the highest accuracy is then:\"]], \"220\" [:div [:p/code {:code \"(def models\\n  (->> evaluations\\n       (map\\n        #(hash-map :model (tech.v3.ml/thaw-model (get-in % [:fitted-ctx :model]))\\n                   :metric (:metric %)\\n                   :fitted-ctx (:fitted-ctx %)\\n                   :data (get-in % [:fitted-ctx :metamorph/data])))\\n       (sort-by :metric)\\n       reverse))\", :bg-class \"bg-light\"}] nil nil], \"182\" [:div nil nil [:p/markdown \"### Use Pclass, Sex, title, age for prediction\"]], \"189\" [:div nil nil [:p/markdown \"The default k-fold splits makes 5 folds,\\nso we train 5 models, each having its own loss.\"]], \"204\" [:div nil nil [:p/markdown \"We can get the predictions, which for classification contain as well\\nthe posterior probabilities per class.\"]], \"178\" [:div [:p/code {:code \"(def splits-1 (tablecloth.api/split->seq data :holdout {:ratio 0.1}))\", :bg-class \"bg-light\"}] nil nil], \"187\" [:div nil nil [:p/markdown \"Evaluate the (single) pipeline function using the train/test split\"]], \"214\" [:div [:p/code {:code \"(def search-grid\\n  (->>\\n   (grid/sobol-gridsearch {:trees (grid/linear 1 500 10)\\n                           :split-rule (grid/categorical [:gini :entropy])\\n                           :max-depth (grid/linear 1 50 10 )\\n                           :node-size (grid/linear 1 10 10)\\n                           :sample-rate (grid/linear 0.1 1 10)\\n                           :mtry (grid/categorical [0 1 2 3 4])\\n                           :use-age? (grid/categorical [true false])})\\n   (take 100))\\n  )\", :bg-class \"bg-light\"}] nil nil], \"215\" [:div nil nil [:p/markdown \"Generate the 100 pipeline-fn we want to evaluate.\"]]}}");
     document.getElementById("loading").remove();
    </script>
</html>
